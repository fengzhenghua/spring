<object classid="clsid:10946843-7507-44FE-ACE8-2B3483D179B7" id="CVR_IDCard" name="CVR_IDCard" width="0" height="0"></object>
<script type="text/javascript" src="/uss_web/js/pcIdReader.js"></script>
<script type="text/javascript" src="/uss_web/js/order/orderUpdate.js"></script>
    <div class="info" id="biangengreaderpage">
    	<div class="title text_big">
        	<span class="text_large24"></span>校验证件
        </div>		
        <ul class="detail">
        	<li class="list">
            	<div class="left">
                	<div class="left_lable">选择型号：</div>
                    <div class="left_data">
                    	<select class="select_down" name="id_card_mech" id="id_card_mech">
                            <option value ="crvu">通用</option>
                        </select>
                    </div>
                    <a href="###"><div class="input_button" id="btn_load">读取</div></a>
                </div>
                <div class="right">
                	<div class="left_lable">校验信息：</div>
                    <div class="left_data" id="jiaoyanxinxi">未校验</div>
                </div>
            </li>            
        	<li class="list">
            	<div class="left">
                	<div class="left_lable">证件类型：</div>
                    <div class="left_data">身份证</div>
                </div>
                <div class="right">
                	<div class="left_lable">证件号码：</div>
                    <div class="left_data" id="pCardNo"></div>
                </div>
            </li>            
            <li class="list">
            	<div class="left">
                	<div class="left_lable">证件名称：</div>
                    <div class="left_data" id="pName"></div>
                </div>
                <div class="right">
                	<div class="left_lable">证件地址：</div>
                    <div class="left_data" id="pAddress"></div>
                </div>            
            </li>  
            <li class="list">
	            <div class="left">
	                <div class="left_lable">联系电话：</div>
	                <div class="left_data">
	                    <input type="text" placeholder="" id="contact_phone" ></input>
	                </div>
	            </div>
	            <div class="right">
	                <div class="left_lable">联系地址：</div>
	                <div class="left_data">
	                    <input type="text" placeholder="" id="contact_address" class="width_32"></input>
	                </div>
	            </div>            
            </li>
            <li class="list">
            	<div class="line_dashed_h"></div>
            </li>
            <li class="list text_big">
                <div class="list_title">本人身份证</div>
            </li>
            <li>
            	<table width="938" border="0" align="center" cellpadding="0" cellspacing="0" class="auto">            	
                  <tr>
                    <td width="468" align="center" style="border-right:1px dashed #CCC;"><table width="340" border="0" align="center" cellpadding="0" cellspacing="0" class="auto">
                      <tr>
                        <td height="216" valign="top" class="card_bg_front">
                         <table width="340" border="0" cellspacing="0" cellpadding="0">
                          <tr>
                            <td height="24"></td>
                          </tr>
                          </table>
                          <table width="340" border="0" cellspacing="0" cellpadding="0">
                            <tr>
                              <td width="55" height="26"><div style="width:55px;"></div></td>
                              <td width="81" height="26" align="left" id="bg_card_name"></td>
                              <td width="68" height="26"></td>
                              <td colspan="2" rowspan="4" valign="top" width="136" align="left"><img src="../../images/photo.png" width="94" height="118" class="card_img" id="idCradImage" /></td>
                            </tr>
                            <tr>
                              <td width="55" height="26"></td>
                              <td height="26" align="left" id="bg_card_sex"></td>
                              <td height="26" align="left" id="bg_card_nation"></td>
                            </tr>
                            <tr>
                              <td width="55" height="26"></td>
                              <td height="26" colspan="2"><table width="149" border="0" cellpadding="0" cellspacing="0">
                                <tr>
                                  <td width="57" align="left" id="bg_card_born_year"></td>
                                  <td width="33" align="left" id="bg_card_born_month"></td>
                                  <td width="59" align="left" id="bg_card_born_day"></td>
                                </tr>
                              </table></td>
                            </tr>
                            <tr>
                              <td width="55"></td>
                              <td height="61" colspan="2" valign="top" class="card_addr"><div style="width:149px;  height:64px; overflow:hidden;" id="bg_card_born_addrss"></div></td>
                            </tr>
                          </table>
                          <table width="340" border="0" cellspacing="0" cellpadding="0">
                            <tr>
                              <td width="110" height="26">&nbsp;</td>
                              <td width="230" align="left" id="bg_card_born_id_number"></td>
                            </tr>
                          </table>
                          <table width="340" border="0" cellspacing="0" cellpadding="0">
                            <tr>
                              <td>&nbsp;</td>
                            </tr>
                          </table></td>
                      </tr>
                    </table></td>
                    <td width="468" align="center"><table width="340" border="0" align="center" cellpadding="0" cellspacing="0" class="auto">
                      <tr>
                        <td height="216" valign="top" class="card_bg_reverse"><table width="340" border="0" cellspacing="0" cellpadding="0">
                          <tr>
                              <td height="148">&nbsp;</td>
                            </tr>
                        </table>
                          <table width="340" border="0" cellspacing="0" cellpadding="0">
                            <tr>
                              <td width="135" height="30">&nbsp;</td>
                              <td width="205" align="left" id="bg_card_idcard_addr"></td>
                            </tr>
                            <tr>
                              <td height="26">&nbsp;</td>
                              <td align="left" id="bg_card_valid"></td>
                            </tr>
                          </table></td>
                      </tr>
                    </table></td>
                  </tr>
                </table>
               
            </li>         
            
            <li class="list"></li>   

        </ul>
        
        <div class="padding_blank10"></div>
            
        <li class="text_large">          
            
            <div class="left ">
            	<div class="ok right_data" style=" margin-right:10px;"><a href="###" id="readerpre">上一步</a></div>
            </div>
            <div class="right">
            	<div class="ok_disabled left_lable" style=" margin-left:10px;" id="jiaoyan_next_class"><a href="###" id="biangengreadernext">下一步</a></div>
            </div>
        </li> 
    	
        

   	
    </div> 
  
<script type="text/javascript">
console.log("1000");
/********************控制页面跳转 上一页 下一页 *************************************
 * 下一步操作 加载对应的html
 */
 	//先创建订单才能取到订单id，顺序不能乱哦
	//创建订单
	ORDER_UPDATE.doCreateOrder({
		 jsessionid: window.parent.application.jsessionid+"PC",
		 tele_type:CUSTOMER_INFO_SEARCH.returndata[0].tele_type,
		 order_sub_type:"10030"},createOrdercallback,true);
	//获取创建的订单id
	function createOrdercallback(){
	 	order_id=ORDER_UPDATE.getOrderId();
	 	PC_IDREADER.pc_idreader_info.order_id=order_id;
	}

	$("#readerpre").click(readerpre);
	//上一步  
	function readerpre(){
		$("#biangengsearchpage").show();		
		$("#biangengreaderpage").hide();
	}
	$("#biangengreadernext").click(biangengreadernext);
	//下一步  订单确认 
	function biangengreadernext(){
		//身份证校验不通过不能下一步
		/*if(PC_IDREADER.pc_idreader_info.next_flag==false){
			return;
		}*/
		//先一步执行前 业务逻辑 
		if(!biangengyewufengzhiNextBefor()){
			
			return;
		}
		//下一步给联系电话和联系地址赋值
		PC_IDREADER.pc_idreader_info.contact_phone=$("#contact_phone").val();
		PC_IDREADER.pc_idreader_info.contact_address=$("#contact_address").val();
		nextpageload(biangengyewufengzhiNextAfter);
		
		$("#biangengreaderpage").hide();
	};
	function nextpageload(pageLoadcallBack){
		//缺省跳转到订单确认页面
		 switch (yewufengzhi) {
		     case ("change_seoncd_menus_jifenduihuan"): 
		    	 if($("#jifenduihuanpage").length > 0){
			 			$("#jifenduihuanpage").show();
			 	 }else{
			    	 $.ajax({
							url:window.parent.application.fullPath+"html/yxs_pctongyi/biangengfangdang/exchangeScore/exchangeScore.html",
							//global: false,
						    type: "GET",
						    dataType: "html",
						    async:false,
						    success: function(data,textStatus){			    	
						    	$("#xiaodipaihanban").append(data);	
						    	//console.log($("#xiaodipaihanban").html())
						    	if(pageLoadcallBack){
						    		pageLoadcallBack();
						    	}
						    },
						    error: function (XMLHttpRequest, textStatus,errorThrown) {
				               var status = XMLHttpRequest.status;
				               //var errorInfo = HTTP_ERROR_STATUES[status];
				               var hint = "网络繁忙，请稍后再试!";//通用万金油提示，都懂得。                
				               var error = hint + ",后台接口报错!";
				               $.alert(errorThrown);
				           }
						});
			 	 }
		         break;		        
		     case ("change_seoncd_menus_yuxiaohu"): 
		    	 if($("#jifenduihuanpage").length > 0){
			 			$("#jifenduihuanpage").show();
			 	 }else{
			 		 
			 	 }
		         break;
		     case ("change_seoncd_menus_ctmy"): 
		    	 if($("#jifenduihuanpage").length > 0){
			 			$("#jifenduihuanpage").show();
			 	 }else{
			 		 
			 	 }
		         break;
		     case ("change_seoncd_menus_guohu"): 
		    	 if($("#jifenduihuanpage").length > 0){
			 			$("#jifenduihuanpage").show();
			 	 }else{
			 		 
			 	 }
		         break;
		     //
		     default:
		    	 if($("#gonggongquerendingdanpage").length > 0){
		 			$("#gonggongquerendingdanpage").show();
		 		}else{
			    	 $.ajax({
							url:window.parent.application.fullPath+"html/yxs_pctongyi/biangengfangdang/common/querendingdan.html",
							//global: false,
						    type: "GET",
						    dataType: "html",
						    async:false,
						    success: function(data,textStatus){			    	
						    	$("#xiaodipaihanban").append(data);	
						    	//$("#biangengreaderpage").hide();
						    	if(pageLoadcallBack){
						    		pageLoadcallBack();
						    	}
						    },
						    error: function (XMLHttpRequest, textStatus,errorThrown) {
				               var status = XMLHttpRequest.status;
				               //var errorInfo = HTTP_ERROR_STATUES[status];
				               var hint = "网络繁忙，请稍后再试!";//通用万金油提示，都懂得。                
				               var error = hint + ",后台接口报错!";
				               $.alert(errorThrown);
				           }
					 });	
		 		}
		    	 
	     }	
		
	};
/********************控制页面跳转 上一页 下一页*************************************/
/********************身份证读取相关*************************************/

$("#btn_load").click(myPcIdReader);
 	//读取身份证信息
 	function myPcIdReader(){	

 		PC_IDREADER.load_card_mech();
 		//测试  身份真读取，校验并添加到数据库
 		var readflag=PC_IDREADER.readCard(window.parent.application.fullPath,myPcIdReaderCallBack);
 		if(!readflag){
 			$.alert("读取失败！");
 		}
 		//校验：获取到的值  不懂要校验毛线？ 各个业务的校验信息不一样   校验缴费各个业务的校验方法实现
 		/*if(geyewuduiyingjiaoyangfangfa){
 			geyewuduiyingjiaoyangfangfa();
 		}else{
 			alert("未校验");
 		} */		
 		
 	};
 	//更新页面显示
 	function myPcIdReaderCallBack(){
 		$('#pName').text(PC_IDREADER.pc_idreader_info.pName);
 		$('#pAddress').text(PC_IDREADER.pc_idreader_info.pAddress);
 		$('#pCardNo').text(PC_IDREADER.pc_idreader_info.pCardNo);
 		//$('#photo_buffer_val').val(base64jpg);
 		$('#idCradImage').attr('src',PC_IDREADER.pc_idreader_info.id_card_image_path+PC_IDREADER.pc_idreader_info.pCardNo+".png");
 		console.info("idCradImage src="+PC_IDREADER.pc_idreader_info.id_card_image_path+PC_IDREADER.pc_idreader_info.pCardNo+".png")
 		//图片上的信息
 		$('#bg_card_name').text(PC_IDREADER.pc_idreader_info.pName);
 		$('#bg_card_sex').text(PC_IDREADER.pc_idreader_info.pSexShow);
 		$('#bg_card_nation').text(PC_IDREADER.pc_idreader_info.pNation);
 		$('#bg_card_born_year').text(PC_IDREADER.pc_idreader_info.year);
 		$('#bg_card_born_month').text(PC_IDREADER.pc_idreader_info.month);
 		$('#bg_card_born_day').text(PC_IDREADER.pc_idreader_info.day);
 		$('#bg_card_born_addrss').text(PC_IDREADER.pc_idreader_info.pAddress);
 		$('#bg_card_idcard_addr').text(PC_IDREADER.pc_idreader_info.pPolice);
 		$('#bg_card_born_id_number').text(PC_IDREADER.pc_idreader_info.pCardNo);
 		$('#bg_card_valid').text(PC_IDREADER.pc_idreader_info.valid_start+"―"+PC_IDREADER.pc_idreader_info.valid_end);
 		//后台拼出来的身份信息和前台的身份信息是否 相互覆盖
 		//$("#idCradImage").attr('src',PC_IDREADER.pc_idreader_info.id_card_image_path+PC_IDREADER.pc_idreader_info.pCardNo+".png");
 	};
 	 	
/********************身份证读取相关 end*************************************/ 
/***********************子菜单 用户选择相关业务逻辑*********************************/

 //处理我业务校验等问题：
 function biangengyewufengzhiNextBefor(){
	 switch (yewufengzhi) {
     case ("fangdang"):    	 
 		 return verifyForm(); 
         break;
     case ("change_seoncd_menus_buka"):
    	var readId=PC_IDREADER.pc_idreader_info.pCardNo;
		var searchId=CUSTOMER_INFO_SEARCH.customer_info.id_number;		
			if(searchId!=readId){
				$.alert("读取的身份证跟办理补卡客户身份证不一致！");
				return false;
			}else{
				return true;
			}		
        break;
     case ("change_seoncd_menus_jifenduihuan"):
    	 var jifenverifyFormflag=false;
    	 loadjavascript(window.parent.application.fullPath+"js/change/jifenduihuanjiaoyan.js",
	 	 			function (){jifenverifyFormflag=jifenverifyForm();}
	 	 	 ); 
    	 return jifenverifyFormflag;
         break;
     case ("change_seoncd_menus_yuxiaohu"):    	 
    	 return false;    	 
         break;
     case ("change_seoncd_menus_ctmy"):    	 
    	 return false;    	 
         break;
     case ("change_seoncd_menus_guohu"):    	 
    	 return false;    	 
         break;
     default:
    	 $.alert("不是返档，请选择要办理的变更业务！");
    	 return false;
 }	
}
 //在订单确认页面 ，需要提前加载的数据或者定义相关处理逻辑函数 (为了订单确认页面可以共用)
 function biangengyewufengzhiNextAfter(){
 	switch (yewufengzhi) {
	     case ("fangdang"):
	     	loadjavascript(window.parent.application.fullPath+"js/change/chargeItemCommon.js",
	 	 			function (){loadjavascript(window.parent.application.fullPath+"js/change/fandang.js")}
	 	 	 ); 
	         break;
	     case ("change_seoncd_menus_jifenduihuan"):
	    	 loadjavascript(window.parent.application.fullPath+"js/change/jifenduihuan.js" ); 
	        break;
	     case ("change_seoncd_menus_yuxiaohu"):      
	         break;
	     case ("change_seoncd_menus_ctmy"):      
	         break;
	     case ("change_seoncd_menus_guohu"):      
	         break;
	     default:
	    	  //alert(" biangengyewufengzhiNextAfter no match");
	 }	
};

/***********************子菜单 用户选择 结束******************************/

</script>
   
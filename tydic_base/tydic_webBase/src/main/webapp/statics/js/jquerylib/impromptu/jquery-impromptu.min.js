jQuery.extend({ImpromptuDefaults:{prefix:"jqi",buttons:{"\u786e\u5b9a":!0},style:{},alertType:"",buttonType:"big",loaded:function(){},submit:function(){return!0},callback:function(){},opacity:.45,zIndex:999,overlayspeed:"slow",promptspeed:"fast",show:"fadeIn",focus:function(){this.blur&&this.blur()},isDrag:!0,firstfocus:!1,useiframe:!1,top:"15%",width:"570px",timeout:0,ieAddHight:30,persistent:!0},ImpromptuStateDefaults:{html:"",buttons:{"\u786e\u5b9a":!0},focus:function(){this.blur&&this.blur()},submit:function(){return!0}},SetImpromptuDefaults:function(a){jQuery.ImpromptuDefaults=jQuery.extend({},jQuery.ImpromptuDefaults,a)},SetImpromptuStateDefaults:function(a){jQuery.ImpromptuStateDefaults=jQuery.extend({},jQuery.ImpromptuStateDefaults,a)},ImpromptuGoToState:function(a){jQuery("."+jQuery.ImpromptuCurrentPrefix+"_state").hide(),jQuery("#"+jQuery.ImpromptuCurrentPrefix+"_state_"+a).show(1,function(){jQuery(this).find("."+jQuery.ImpromptuCurrentPrefix+"defaultbutton").focus()})},ImpromptuClose:function(){var a=jQuery("#"+jQuery.ImpromptuCurrentPrefix+"box").find("iframe").size();jQuery("#"+jQuery.ImpromptuCurrentPrefix+"box").fadeOut("fast",function(){jQuery(this).remove()}),jQuery(window).focus(),jQuery.firstFocus(a),jQuery.ChangeIe6Select("visible")},ImpromptuCloseById:function(a){var b=jQuery("#"+jQuery.ImpromptuCurrentPrefix+"box").find("iframe").size();jQuery("#"+jQuery.ImpromptuCurrentPrefix+"box"+a).fadeOut("fast",function(){jQuery(this).remove()}),jQuery(window).focus(),jQuery.firstFocus(b),jQuery.ChangeIe6Select("visible")},rolePerNeedClose:function(a,b){var c=jQuery("#"+jQuery.ImpromptuCurrentPrefix+"box").find("iframe").size();return jQuery("#"+jQuery.ImpromptuCurrentPrefix+"box").fadeOut("fast",function(){jQuery(this).remove()}),jQuery(window).focus(),jQuery.firstFocus(c),jQuery.ChangeIe6Select("visible"),"per"==b?(manageEmp(a,b),void 0):("emp"==b&&managePer(a),void 0)},ImpromptuCurrentPrefix:"jqi",ChangeIe6Select:function(a){var b=!1;"undefined"==typeof document.body.style.maxHeight&&(b=!0),b&&(jQuery("select").css("visibility",a),jQuery("iframe").size()>0&&jQuery("iframe").each(function(){$(this).contents().find("select").css("visibility",a),$(this).contents().find("iframe").each(function(){$(this).contents().find("select").css("visibility",a)})}))},firstFocus:function(a){var b=document.all?"IE":"others";"IE"==b&&a>0&&(jQuery.ImpromptuFirstFocus?$(jQuery.ImpromptuFirstFocus).focus():$("input:text").length>0&&$("input:text").eq(0).focus())},prompt:function(a,b,c,d){c=jQuery.extend({},jQuery.ImpromptuDefaults,c),jQuery.ImpromptuCurrentPrefix=c.prefix,jQuery.ImpromptuFirstFocus=c.firstfocus;var e=!1;"undefined"==typeof document.body.style.maxHeight&&(e=!0);var f=jQuery(document.body),g=jQuery(window),h="";a&&""!=a&&(h='<div class="'+c.prefix+'title"><span class="'+c.prefix+'tip">'+a+"</span></div>");var i='<table class="table"><tr><td class="impromptu_alert_image"><div class="image_msg right_msg"></div></td><td align="left" class ="spans">',j='<table class="table"><tr><td class="impromptu_alert_image"><div class="image_msg ask_msg"></div></td><td align="left" class ="spans">',k='<table class="table"><tr><td class="impromptu_alert_image"><div class="image_msg msg_msg"></div></td><td align="left" class ="spans">',l='<table class="table"><tr><td class="impromptu_alert_image"><div class="image_msg warn_msg"></div></td><td align="left" class ="spans">',m='<table class="table"><tr><td class="impromptu_alert_image"><div class="image_msg error_msg"></div></td><td align="left" class ="spans">',n='<table class="table"><tr><td class="impromptu_alert_image"><div class="image_msg sucess_msg"></div></td><td align="left" class ="spans">',o='<table class="table"><tr><td>',p="</td></tr></table>";b="msg"==c.alertType?h+k+b+p:"warn"==c.alertType?h+l+b+p:"ask"==c.alertType?h+j+b+p:"right"==c.alertType?h+i+b+p:"error"==c.alertType?h+m+b+p:"sucess"==c.alertType?h+n+b+p:h+o+b+p;var q="";q=d?'<div class="'+c.prefix+'box" id="'+c.prefix+"box"+d+'">':'<div class="'+c.prefix+'box" id="'+c.prefix+'box">',c.useiframe&&(jQuery("object, applet").length>0||e)?q+='<iframe src="javascript:;" class="'+c.prefix+'fade" id="'+c.prefix+'fade"></iframe>':(jQuery.ChangeIe6Select("hidden"),q+='<div class="'+c.prefix+'fade" id="'+c.prefix+'fade"></div>'),q+='<div class="'+c.prefix+'" id="'+c.prefix+'"><div class="'+c.prefix+'container">',(c.closeable||"undefined"==c.closeable||null==c.closeable)&&(q+='<div class="'+c.prefix+'close"></div>'),q+='<div id="'+c.prefix+'states"></div>',q+="</div></div></div>";var r=$(q).appendTo(f),s=r.children("#"+c.prefix),t=r.children("#"+c.prefix+"fade");b.constructor==String&&(b={state0:{html:b,buttons:c.buttons,focus:c.focus,submit:c.submit}});var u="";jQuery.each(b,function(a,d){d=jQuery.extend({},jQuery.ImpromptuStateDefaults,d),b[a]=d;var e=0;jQuery.each(d.buttons,function(){e++}),u+='<div id="'+c.prefix+"_state_"+a+'" class="'+c.prefix+'_state" style="display:none;"><div class="'+c.prefix+'message">'+d.html+'</div><div class="'+c.prefix+'buttons"',0>=e&&(u+=' style="display:none"'),u+='><div class="'+c.prefix+'footer">',u+='<input type="hidden" id="focus_button" />';var f=0;jQuery.each(d.buttons,function(b,d){u+='<button name="'+c.prefix+"_"+a+"_button"+b+'" id="'+c.prefix+"_"+a+"_button"+b+'"',0==f&&(u+=' class="'+c.prefix+"ok"+c.buttonType+'button"'),100==d&&(u+=' style="background-color: #666666;" disabled="true"'),null!=c.style[b]&&""!=c.style[b]&&(u+=' style="'+c.style[b]+'"'),u+=' value="'+d+'">'+b+"</button>",f++}),u+="</div></div></div>"}),s.find("#"+c.prefix+"states").html(u).children("."+c.prefix+"_state:first").css("display","block"),jQuery.each(b,function(a,b){var d=s.find("#"+c.prefix+"_state_"+a);d.children("."+c.prefix+"buttons").children("."+c.prefix+"footer").children("button").click(function(){var a=d.children("."+c.prefix+"message"),e=b.buttons[jQuery(this).text()],f={};jQuery.each(s.find("#"+c.prefix+"states :input").serializeArray(),function(a,b){void 0==f[b.name]?f[b.name]=b.value:typeof f[b.name]==Array?f[b.name].push(b.value):f[b.name]=[f[b.name],b.value]}),b.submit(e,a,f)&&A(!0,e,a,f)}),d.find("."+c.prefix+"buttons ."+c.prefix+"footer button").bind(b.focus).addClass(c.prefix+c.buttonType+"button")});var v=function(){},w=function(){if(c.persistent){var a=0;r.addClass(c.prefix+"warning");var b=setInterval(function(){r.toggleClass(c.prefix+"warning"),a++>1&&(clearInterval(b),r.removeClass(c.prefix+"warning"))},100)}else A()},x=function(a){var b=window.event?event.keyCode:a.keyCode;27==b&&A()},y=function(){var a=document.body.scrollHeight;a+=c.ieAddHight;var b=g.height(),d=a>b?a:b;r.css({position:e?"absolute":"fixed",height:g.height(),width:g.width(),top:e?g.scrollTop():0,left:0,right:0,bottom:0}),t.css({position:"absolute",height:e?d:g.height(),width:g.width(),top:e?-g.scrollTop():0,left:0,right:0,bottom:0});var f=(g.width()-c.width.substring(0,c.width.length-2))/2;s.css({position:"absolute",top:c.top,left:f,width:c.width,height:c.height})},z=function(){var a=document.body.scrollHeight;a+=c.ieAddHight;var b=g.height(),d=a>b?a:b;r.css({position:e?"absolute":"fixed",height:g.height(),width:g.width(),top:e?g.scrollTop():0,left:0,right:0,bottom:0,zIndex:c.zIndex}),t.css({position:"absolute",height:e?d:g.height(),width:g.width(),top:e?-g.scrollTop():0,left:0,right:0,bottom:0,zIndex:c.zIndex,display:"none",opacity:c.opacity});var f=(g.width()-c.width.substring(0,c.width.length-2))/2;s.css({position:"absolute",top:c.top,left:f,width:c.width,height:c.height,zIndex:c.zIndex+1,display:"none"})},A=function(a,b,d,h){var i=jQuery("#"+jQuery.ImpromptuCurrentPrefix+"box").find("iframe").size();s.remove(),e&&f.unbind("scroll",v),g.unbind("resize",y),t.fadeOut(c.overlayspeed,function(){t.unbind("click",w),t.remove(),a&&c.callback(b,d,h),r.unbind("keypress",x),r.remove(),jQuery.firstFocus(i),jQuery.ChangeIe6Select("visible")}),g.focus()},B=function(){c.isDrag&&($("."+c.prefix).css("cursor","move"),$("."+c.prefix).find(":checkbox").css("cursor","auto"),$("."+c.prefix).find(":radio").css("cursor","auto"),$("."+c.prefix).draggable())};return z(),B(),t.click(w),g.resize(y),r.keypress(x),s.find("."+c.prefix+"close").click(A),t.fadeIn(c.overlayspeed),s[c.show](c.promptspeed,c.loaded),s.find("#focus_button").focus(),c.timeout>0&&setTimeout(A,c.timeout),r}});